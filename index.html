<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gelişmiş Giriş ve Kayıt Sistemi</title>
    <style>
        /* --- GENEL SAYFA AYARLARI --- */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* --- FORM KUTUSU TASARIMI --- */
        .container {
            background-color: #ffffff;
            width: 100%;
            max-width: 400px;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        /* --- FORM ELEMANLARI --- */
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-weight: 600;
            font-size: 0.95rem;
        }

        input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 6px;
            box-sizing: border-box; /* Padding taşmasını engeller */
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        /* Input'a tıklandığında (focus) oluşan efekt */
        input:focus {
            border-color: #5865F2;
            outline: none;
            box-shadow: 0 0 0 3px rgba(88, 101, 242, 0.1);
        }

        /* --- HATA MESAJLARI (DISCORD TARZI) --- */
        .error-msg {
            color: #ed4245; /* Discord kırmızısı */
            font-size: 0.85rem;
            margin-top: 6px;
            display: none; /* Başlangıçta gizli */
            font-weight: 500;
        }

        /* --- BUTONLAR --- */
        button {
            width: 100%;
            padding: 14px;
            background-color: #5865F2; /* Discord mavisi */
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
        }

        button:hover {
            background-color: #4752c4;
        }

        button:active {
            transform: scale(0.98);
        }

        /* --- LİNKLER VE GEÇİŞLER --- */
        .toggle-link {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #007bff;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .toggle-link:hover {
            color: #0056b3;
        }

        /* --- ŞİFRE GÖSTER/GİZLE İKONU --- */
        .password-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            cursor: pointer;
            color: #888;
            font-size: 0.8rem;
            user-select: none;
            font-weight: bold;
        }

        .toggle-password:hover {
            color: #333;
        }

        /* --- GİZLEME SINIFI --- */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div id="register-form">
        <h2>Hesap Oluştur</h2>
        
        <div class="form-group">
            <label for="reg-username">Kullanıcı Adı</label>
            <input type="text" id="reg-username" placeholder="Kullanıcı adınızı belirleyin" autocomplete="off">
            <div id="err-username" class="error-msg">Hata mesajı burada görünecek.</div>
        </div>

        <div class="form-group">
            <label for="reg-email">E-posta Adresi</label>
            <input type="email" id="reg-email" placeholder="ornek@email.com" autocomplete="off">
            <div id="err-email" class="error-msg">Hata mesajı burada görünecek.</div>
        </div>

        <div class="form-group">
            <label for="reg-age">Yaş</label>
            <input type="number" id="reg-age" min="0" placeholder="Yaşınız">
            <div id="err-age" class="error-msg">Hata mesajı burada görünecek.</div>
        </div>

        <div class="form-group">
            <label for="reg-pass">Şifre (En az 8 karakter)</label>
            <div class="password-wrapper">
                <input type="password" id="reg-pass" placeholder="********">
                <span class="toggle-password" onclick="togglePass('reg-pass', this)">GÖSTER</span>
            </div>
            <div id="err-pass" class="error-msg">Hata mesajı burada görünecek.</div>
        </div>

        <div class="form-group">
            <label for="reg-pass-confirm">Şifre Tekrar</label>
            <div class="password-wrapper">
                <input type="password" id="reg-pass-confirm" placeholder="********">
                <span class="toggle-password" onclick="togglePass('reg-pass-confirm', this)">GÖSTER</span>
            </div>
            <div id="err-pass-confirm" class="error-msg">Hata mesajı burada görünecek.</div>
        </div>

        <button onclick="registerUser()">Kayıt Ol</button>
        <div class="toggle-link" onclick="switchForm('login')">Zaten hesabın var mı? Giriş Yap</div>
    </div>


    <div id="login-form" class="hidden">
        <h2>Giriş Yap</h2>
        
        <div class="form-group">
            <label for="login-input">E-posta veya Kullanıcı Adı</label>
            <input type="text" id="login-input" placeholder="Kullanıcı adı veya e-posta girin">
            <div id="err-login-input" class="error-msg">Hata mesajı burada görünecek.</div>
        </div>

        <div class="form-group">
            <label for="login-pass">Şifre</label>
            <div class="password-wrapper">
                <input type="password" id="login-pass" placeholder="********">
                <span class="toggle-password" onclick="togglePass('login-pass', this)">GÖSTER</span>
            </div>
            <div id="err-login-pass" class="error-msg">Hata mesajı burada görünecek.</div>
        </div>

        <button onclick="loginUser()">Giriş Yap</button>
        <div class="toggle-link" onclick="switchForm('register')">Hesabın yok mu? Hesap Oluştur</div>
    </div>

</div>

<script>
    /**
     * VERİTABANI İŞLEMLERİ (LocalStorage)
     * Gerçek bir projede bu veriler sunucuda (backend) tutulur.
     * Burada tarayıcı hafızasını kullanarak kalıcı kayıt yapıyoruz.
     */
    
    // Kayıtlı kullanıcıları getir
    function getUsers() {
        const users = localStorage.getItem('users_db');
        return users ? JSON.parse(users) : [];
    }

    // Yeni kullanıcı kaydet
    function saveUser(userObj) {
        const users = getUsers();
        users.push(userObj);
        localStorage.setItem('users_db', JSON.stringify(users));
    }

    /**
     * YARDIMCI FONKSİYONLAR
     */

    // Hata mesajını göster (inputun altındaki kırmızı yazı)
    function showError(elementId, message) {
        const el = document.getElementById(elementId);
        el.innerText = message;
        el.style.display = 'block';
        
        // Hata alan inputun kenarlığını kırmızı yap
        // Bu özellik inputun parent elementindeki label'ın kardeşini bulur vs.
        // Basitlik için sadece metni gösteriyoruz ama istenirse inputa .error class'ı da eklenebilir.
    }

    // Tüm hataları temizle
    function clearErrors() {
        const errors = document.querySelectorAll('.error-msg');
        errors.forEach(err => {
            err.style.display = 'none';
            err.innerText = '';
        });
    }

    // E-posta formatı doğrulama (Regex)
    // Sadece "blah" yazılmasını engeller, "@" ve "." arar.
    function validateEmail(email) {
        const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
    }

    // Şifre Göster/Gizle İşlevi
    function togglePass(inputId, btnElement) {
        const input = document.getElementById(inputId);
        if (input.type === "password") {
            input.type = "text";
            btnElement.innerText = "GİZLE";
        } else {
            input.type = "password";
            btnElement.innerText = "GÖSTER";
        }
    }

    // Formlar arası geçiş (Giriş <-> Kayıt)
    function switchForm(target) {
        clearErrors(); // Geçiş yaparken eski hataları temizle
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');

        if(target === 'login') {
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        } else {
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
        }
    }

    /**
     * KAYIT OLMA FONKSİYONU
     * Tüm validasyonlar (doğrulamalar) burada yapılır.
     */
    function registerUser() {
        // Önce temizlik
        clearErrors();
        
        // Değerleri al
        const username = document.getElementById('reg-username').value.trim();
        const email = document.getElementById('reg-email').value.trim();
        const age = document.getElementById('reg-age').value;
        const pass = document.getElementById('reg-pass').value;
        const passConfirm = document.getElementById('reg-pass-confirm').value;

        let hasError = false;

        // 1. Kullanıcı Adı Kontrolü
        if (username === "") {
            showError('err-username', 'Kullanıcı adı boş bırakılamaz.');
            hasError = true;
        } else if (username.length < 3) {
            showError('err-username', 'Kullanıcı adı en az 3 karakter olmalıdır.');
            hasError = true;
        }

        // 2. E-posta Format Kontrolü
        if (email === "") {
            showError('err-email', 'E-posta alanı boş bırakılamaz.');
            hasError = true;
        } else if (!validateEmail(email)) {
            showError('err-email', 'Geçersiz e-posta adresi. Lütfen kontrol edin.');
            hasError = true;
        }

        // 3. Yaş Kontrolü
        if (age === "") {
            showError('err-age', 'Lütfen yaşınızı girin.');
            hasError = true;
        } else {
            const ageNum = parseInt(age);
            if (ageNum < 0) {
                showError('err-age', 'Yaş negatif olamaz! Lütfen düzeltin.');
                hasError = true;
            } else if (ageNum > 120) {
                showError('err-age', 'Lütfen geçerli bir yaş girin.');
                hasError = true;
            }
        }

        // 4. Şifre Uzunluk Kontrolü
        if (pass.length < 8) {
            showError('err-pass', 'Şifre en az 8 karakterden oluşmalıdır.');
            hasError = true;
        }

        // 5. Şifre Eşleşme Kontrolü
        if (pass !== passConfirm) {
            showError('err-pass-confirm', 'Girdiğiniz şifreler birbiriyle uyuşmuyor.');
            hasError = true;
        }

        // Eğer yukarıdaki kontrollerden herhangi biri takıldıysa işlemi durdur.
        if (hasError) return;

        // 6. Veritabanı Kontrolü (Aynı e-posta veya kullanıcı adı var mı?)
        const users = getUsers();
        
        const emailExists = users.some(u => u.email === email);
        if (emailExists) {
            showError('err-email', 'Bu e-posta adresi zaten kayıtlı.');
            return;
        }

        const usernameExists = users.some(u => u.username === username);
        if (usernameExists) {
            showError('err-username', 'Bu kullanıcı adı başkası tarafından alınmış.');
            return;
        }

        // --- HER ŞEY BAŞARILI ---
        
        // Simüle edilmiş kod gönderme işlemi
        alert(`Kayıt işleminiz başarılı!\n\nGüvenlik kodu şu adrese gönderildi: ${email}\n(Kod: 123456 - Simülasyon)`);

        // Kullanıcıyı kaydet
        const newUser = {
            id: Date.now(), // Benzersiz ID
            username: username,
            email: email,
            age: age,
            pass: pass // Not: Gerçekte şifreler kriptolanmalıdır!
        };
        
        saveUser(newUser);

        // Formu temizle ve Giriş ekranına yönlendir
        document.getElementById('reg-username').value = '';
        document.getElementById('reg-email').value = '';
        document.getElementById('reg-age').value = '';
        document.getElementById('reg-pass').value = '';
        document.getElementById('reg-pass-confirm').value = '';
        
        switchForm('login');
    }

    /**
     * GİRİŞ YAPMA FONKSİYONU
     */
    function loginUser() {
        clearErrors();

        const input = document.getElementById('login-input').value.trim();
        const pass = document.getElementById('login-pass').value;

        if (input === "") {
            showError('err-login-input', 'Lütfen e-posta veya kullanıcı adınızı girin.');
            return;
        }
        
        if (pass === "") {
            showError('err-login-pass', 'Lütfen şifrenizi girin.');
            return;
        }

        const users = getUsers();
        
        // Kullanıcıyı bul (Hem email hem username kontrolü)
        const user = users.find(u => u.email === input || u.username === input);

        if (!user) {
            // Güvenlik gereği "Böyle bir kullanıcı yok" yerine genel hata da verilebilir ama 
            // isteğin üzerine spesifik uyarı veriyoruz.
            showError('err-login-input', 'Bu bilgilere ait bir kullanıcı bulunamadı.');
            return;
        }

        // Şifre kontrolü
        if (user.pass === pass) {
            alert('Giriş Başarılı! Hoşgeldin, ' + user.username);
            // Başarılı girişten sonra yapılacak işlemler buraya...
            // window.location.href = '/dashboard'; gibi.
        } else {
            showError('err-login-pass', 'Girdiğiniz şifre hatalı.');
        }
    }
</script>

</body>
</html>